"use strict";var scale=null,toolBar=null,overView=null,map=null,marker=null;function onApiLoaded(){map=new AMap.Map("mapContainer",{zoom:6}),marker=new AMap.Marker({map:map})}
"use strict";var $content=$(".content"),$sendMsg=$("#sendMsg"),$onlineSlide=$("#onlineSlide"),$container=$("#mapContainer"),msgNum=0,MaxMsgNum=20,msgInTime=0,onlineNum=0,name="",id="",imgId=0,dataBind={},css=["css/light.css",""],js=["js/colorfulBall.js","js/skyGrain.js"],currentSkin=1;Object.defineProperty(dataBind,"uncheckedMsg",{enumerable:!0,set:function(e){this.value=e,0!=this.value?$(".unmsg-hint").text(e).show():$(".unmsg-hint").hide()},get:function(){return this.value}});var s=io.connect("http://www.hanqx.xin");function changeName(t){$content.children("[data-id = "+t.id+"]").each(function(e,n){$(n).find(".name").text(t.name)}),$onlineSlide.children("[data-id = "+t.id+"]").text(t.name)}function send(){var e=$sendMsg[0].value;if(""==e){var n=Object.assign($sendMsg.offset(),{width:$sendMsg.width(),height:$sendMsg.height()}),t=n.left,i=n.top;n.width,n.height;return hintToArea({x:t+5,y:i-5,msg:"输入为空!",color:"red"}),!1}inputTextTo({msg:e,name:name,id:id},"right"),adjustScroll($content[0]),s.emit("news",{msg:e,name:name,id:id}),$sendMsg[0].value=""}function inputTextTo(e,n){var t=getTime(),i='\n\t\t\t<div class="subMsg w100 clearfix '+n+'" data-id="'+e.id+'">\n\t\t\t\t<p class="time w100"><span class="t">'+t.time+'</span><span class="name">'+e.name+'</span></p>\n\t\t\t\t<xmp class="msg">'+e.msg+"</xmp>\n\t\t\t</div>\n\t\t";$content[0].innerHTML+=i,msgNum++,msgInTime++}function hintToArea(e){$("<span></span>").css({display:"none",position:"absolute",top:e.y+"px",left:e.x+"px",padding:e.padding||"3px",color:e.color||"#333",border:"1px solid #333",borderRadius:"5px",backgroundColor:e.backgroundColor||"white",textAlign:"center"}).text(e.msg).appendTo(document.body).show(300).delay(1e3).hide(300).queue(function(){$(this).remove()})}function inputHintTo(e,n,t){isViewBottom($content[0]);var i='\n\t\t\t<p class="hint" style="color:'+(t||"red")+'">'+e+"</p>\n\t\t";"top"==n?$content[0].innerHTML=i+$content[0].innerHTML:"bottom"==top&&($content[0].innerHTML+=i),adjustScroll($content[0],15)}function getTime(){var e=new Date,n=e.getFullYear(),t=e.getMonth()+1,i=e.getDate();0==e.getDay()||e.getDay();return{year:n+"-"+t+"-"+i,time:(e.getHours()<10?0+e.getHours().toString():e.getHours())+":"+(e.getMinutes()<10?0+e.getMinutes().toString():e.getMinutes())+":"+(e.getSeconds()<10?0+e.getSeconds().toString():e.getSeconds())}}function adjustScroll(e,n){if(n)e.scrollTop+=n;else{var t=e.scrollHeight,i=e.clientHeight;t!=i&&(e.scrollTop=t-i)}}function remove(e,n){for(var t=0;t<n;t++)e.removeChild(e.firstElementChild)}function createFloatMsg(e){$("<span class='floatMsg'>"+e+"</span>").css({position:"absolute",right:"-250px",top:"100px",whiteSpace:"nowrap"}).appendTo(document.body).delay(500).animate({right:window.innerWidth},5e3,"linear",function(){$(this).remove()})}function isViewBottom(e){var n=e.scrollHeight,t=e.clientHeight;return n==t||!(e.scrollTop<n-t)}s.on("news",function(e){var n=isViewBottom($content[0]);"map"==e.type?inputMapTo(e,""):inputTextTo(e,""),n||(dataBind.uncheckedMsg+=1),n&&adjustScroll($content[0])}),s.on("initData",function(e){var n=window.localStorage.getItem("qwertyuiop/name");name=n||e.name,id=e.id,$("#name")[0].value=name,s.emit("clientServerName",{name:name})}),s.on("onlinenum",function(e){$(".numOfOnline").text(e.msg),e.msg>onlineNum&&createFloatMsg("当前在线人数为:"+e.msg+"人"),onlineNum=e.msg}),s.on("changeName",function(e){changeName(e)}),s.on("serverClientOnlinePersons",function(e){var n="";for(var t in e)t!=id&&(n+='<li class="p-r" data-id="'+t+'">'+e[t].name+"</li>");$onlineSlide.html(n)}),$("input[type='button']").click(function(){$sendMsg.focus(),send()}),$sendMsg.on("keydown",function(e){13==e.keyCode&&(e.preventDefault(),send(),$(this).focus())}),$("#changeName").click(function(){$("#name").removeAttr("disabled").focus(),$("#name").blur(function(){var e=$(this)[0].value,n=!1,t="";if(""==e?(t="名字不能为空",n=!0):10<e.length?(t="名字过长",n=!0):/^网友[\d]+$/.test(e)&&(t="请换个名字",n=!0),n){$(this).focus();var i=$(this).offset();hintToArea({x:i.left+5,y:i.top,msg:t,color:"red",backgroundColor:"white"})}else name=e,window.localStorage.setItem("qwertyuiop/name",name),changeName({id:id,name:name}),s.emit("changeName",{id:id,name:name}),$(this).attr("disabled","true")})}),$(".leftInfo .onlineMsg .arrowTop").click(function(){$(this).children("i").toggleClass("on"),$onlineSlide.slideToggle("fast","linear")}),$content.on("scroll",function(){0!==dataBind.uncheckedMsg&&isViewBottom($content[0])&&(dataBind.uncheckedMsg=0)}),$(".unmsg-hint").click(function(){adjustScroll($content[0])}),$(".clearMsg").mouseover(function(e){var n=$(this).offset();hintToArea({x:n.left,y:n.top-25,msg:"清屏"})}),$(".clearMsg").click(function(e){$content.html("")}),$(".skin").mouseover(function(e){var n=$(this).offset();hintToArea({x:n.left,y:n.top-25,msg:"换肤"})}),$(".skin").click(function(e){$("#skincss")[0].href=css[++currentSkin%2]}),$(".imgProfile").mouseover(function(e){var n=$(this).offset();hintToArea({x:n.left,y:n.top-25,msg:"发送图片"})}),$(".map").mouseover(function(e){var n=$(this).offset();hintToArea({x:n.left,y:n.top-25,msg:"查看位置"})}),$(".map").click(function(){if($(".hideMap").css("opacity","1").css("animationName","showMap"),"undefined"==typeof AMap){var e=document.createElement("script");e.charset="utf-8",e.src="https://webapi.amap.com/maps?v=1.4.8&key=d7ee319b3be4e1071f1f50637a82bd3a&callback=onApiLoaded&&plugin=AMap.Scale,AMap.OverView,AMap.ToolBar",document.head.appendChild(e)}else map=new AMap.Map("mapContainer",{zoom:6}),marker=new AMap.Marker({map:map})}),$(".clearMap").click(function(){$(".hideMap").css("animationName","")}),$content[0].addEventListener("click",function(e){e.target.id},!1),function e(){MaxMsgNum<msgNum&&(remove($content[0],msgNum-MaxMsgNum),inputHintTo("以上为历史消息,暂时不可查看","top"),msgNum=MaxMsgNum),setTimeout(e,3e5)}(),function e(){20<=msgInTime&&(msgInTime=0,inputHintTo(getTime().year,"top","rgb(50,255,50)")),setTimeout(e,3e5)}();
"use strict";function inputImgTo(e,t){var i=getTime(),n='\n\t\t<div class="subMsg w100 clearfix '+t+'" data-id="'+e.id+'" data-imgId="'+ ++imgId+'">\n\t\t\t<p class="time w100"><span class="t">'+i.time+'</span><span class="name">'+e.name+"</span></p>\n\t\t</div>\n\t";return $content[0].innerHTML+=n,msgNum++,msgInTime++,imgId}s.on("imgProfile",function(e){if(id!=e.id){var t=isViewBottom($content[0]),i=inputImgTo(e,"left"),n=document.createElement("img"),a=document.createElement("img"),s=!1,m=!1;a.onload=function(){s||(m=!0,$('.subMsg[data-imgId="'+i+'"]').append(a))},a.src="./img/loadingImg.gif",n.onload=function(){s=!0,m&&$('.subMsg[data-imgId="'+i+'"]')[0].removeChild(a),$('.subMsg[data-imgId="'+i+'"]')[0].appendChild(n),t?adjustScroll($content[0]):dataBind.uncheckedMsg+=1},n.src=e.src}}),$("#imgProfile").change(function(){var e=this.files[0],t=e.size,i=$(".imgProfile").offset();if(0===e.type.indexOf("image"))if(1048576<t)hintToArea({x:i.left,y:i.top-25,msg:"图片应小于1MB"});else{var n=document.createElement("img");inputImgTo({id:id,name:name},"right"),n.onload=function(){$('.subMsg[data-imgId="'+imgId+'"]')[0].appendChild(n),adjustScroll($content[0])},n.src=window.URL.createObjectURL(e);var a=ss.createStream();ss(s).emit("imgProfile",a,{name:name,fileName:e.name,size:t}),ss.createBlobReadStream(e).pipe(a)}else hintToArea({x:i.left,y:i.top-25,msg:"请上传图片文件!",color:"red"})});
"use strict";function sendMap(){var a={id:id,name:name,x:map.getCenter().lat,y:map.getCenter().lng};s.emit("mapMsg",a),inputMapTo(a,"right"),adjustScroll($content[0]),$(".hideMap").css("animationName","")}function inputMapTo(a,t){var n=getTime(),s='\n\t\t<div class="subMsg w100 '+t+'" data-id="'+a.id+'" style="height:120px">\n\t\t\t<p class="time w100"><span class="t">'+n.time+'</span><span class="name">'+a.name+'</span></p>\n\t\t\t<div class="text-map p-r '+t+'">\n\t\t\t  <img src="img/map.jpg" width="100" height="100" alt="" title="点击查看">\n        <span id="showMap" class="p-a" data-x="'+a.x+'" data-y="'+a.y+'" onclick="showMap(this)">点击查看</span>\n      </div>\n\t\t</div>\n\t';$content[0].innerHTML+=s,msgNum++,msgInTime++}function showMap(a){"showMap"==a.id&&(map=new AMap.Map("mapContainer",{zoom:6,center:[Number(a.dataset.y),Number(a.dataset.x)]}),marker=new AMap.Marker({map:map}),$(".hideMap").css("opacity","1").css("animationName","showMap"))}
"use strict";var canvas=document.getElementById("canvas");canvas||((canvas=document.createElement("canvas")).id="canvas",document.body.appendChild(canvas));var width=canvas.width=window.innerWidth,height=canvas.height=window.innerHeight,ctx=canvas.getContext("2d"),data=[],num=250,mouseX=0,mouseY=0;function init(){document.addEventListener("mousemove",function(a){a=a||window.event;mouseX=a.x,mouseY=a.y},!1),createGrain(),setInterval(move,20)}function createGrain(){for(var a=0;a<num;a++)data[a]={},data[a].x=Math.random()*width,data[a].y=Math.random()*height,data[a].sx=1*-Math.random()+.5,data[a].sy=1*-Math.random()+.5,drawArc(data[a].x,data[a].y)}function move(){var a=data.length;ctx.clearRect(0,0,width,height);for(var t=0;t<a;t++){data[t].x+=data[t].sx,data[t].y+=data[t].sy,(data[t].x<0||data[t].x>width)&&(data[t].sx=-data[t].sx),(data[t].y<0||data[t].y>height)&&(data[t].sy=-data[t].sy);for(var e=t+1;e<a;e++)Math.pow(data[t].x-data[e].x,2)+Math.pow(data[t].y-data[e].y,2)<=2e3&&drawLine(data[t].x,data[t].y,data[e].x,data[e].y);drawArc(data[t].x,data[t].y)}}function drawArc(a,t){ctx.save(),ctx.beginPath(),ctx.strokeStyle="rgba(255,255,255,.3)",ctx.arc(a,t,1,0,2*Math.PI),ctx.stroke(),ctx.closePath(),ctx.restore()}function drawLine(a,t,e,d,n){ctx.strokeStyle=n||"rgba(255,255,255,.1)",ctx.save(),ctx.beginPath(),ctx.moveTo(a,t),ctx.lineTo(e,d),ctx.stroke(),ctx.closePath(),ctx.restore()}init();